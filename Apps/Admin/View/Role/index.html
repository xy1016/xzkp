<extend name="Public/layout" />
<block name="cssFile">
<link href="__ROOT__/Static/css/plugins/iCheck/custom.css" rel="stylesheet">
</block>
<block name="content">
  <div class="ibox-title">
    <button class="btn btn-primary btn-xs" onclick="location.reload()"><i class="fa fa-refresh"></i></button>
  </div>
<div class="ibox-content">
    <div style="margin:10px 0">
        <span class="l"><a onclick="showModal('__URL__/create', 'modal_create')" class="btn btn-success">添加角色</a></span>
        <span class="l"><a onclick="" class="btn btn-danger">删除角色</a></span>
    </div>
        <div>
        <table id="dataTable" class="table table-border table-bordered table-hover table-bg table-sort" style="border-width:1px">
        <thead>
            <tr>
                <th width="4"></th>
                <th>名称</th>
                <th>描述</th>
                <th>用户</th>
            </tr>
        </thead>
        <tbody>
        <foreach name="list" item="v">
            <tr>
               <td class="idColumn">
                    <div><label style="padding-top:0.5em"><input type="checkbox" value="{$v['id']}" name="id"></label></div>
                 </td>
                <td>{$v['name']}</td>
                 <th>{$v['remark']}</th>
                <td></td>
            </tr>
        </foreach> 
        </tbody>
    </table>
        </div>
        <ul class="pagination" style="margin-bottom:20px">{$btn}</ul>
     <script> 
        $('.pagination a').unwrap('div').wrap('<li></li>');
        $('.pagination span').wrap('<li class="active"></li>');
    </script>   
    </div>
<div id="modalContainer" style="display:none"></div>
<script>
var flag = true;
function updateAll()
{
  if(flag === false) return false;
  flag = false;
  $("#updateAll").text("更新中...");
  $.post("{:U('Admin/Node/update_all')}", function(data){
    if(data.status=1){
      $("#updateAll").text("自动更新");
      swal("更新成功！", "您更新了" + data.info + "个权限", "success");
      flag = true;
    }
  });
}

function showModal(url, modalID){
    var id = $(".idColumn input:checked").val();
    if(id == undefined && modalID != 'modal_create') return false;
    var url = url + "/id/" + id;
    $("#modalContainer").load(url, function(response, status, xhr){
        $("#" + modalID).modal('show');
        $.getScript("__ROOT__/Static/js/content.min.js?v=1.0.0", function() {});
    })
}

$(function(){
  $(".idColumn input").click(function(){
        $(".idColumn input").not(this).removeAttr("checked");
    });
})
</script>
</block>